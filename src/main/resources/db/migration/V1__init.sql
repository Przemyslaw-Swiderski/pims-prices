SET REFERENTIAL_INTEGRITY TRUE;

CREATE TABLE IF NOT EXISTS products (
    id VARCHAR(255) PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    ean VARCHAR(255) NOT NULL
);

CREATE TABLE IF NOT EXISTS prices (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    product_id VARCHAR(255),
    price NUMERIC(38,2),
    currency VARCHAR(255),
    CONSTRAINT fk_products FOREIGN KEY (product_id) REFERENCES products (id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS prices_categories (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255)
);

CREATE TABLE IF NOT EXISTS prices_and_prices_categories (
    price_id BIGINT NOT NULL,
    prices_category_id BIGINT NOT NULL,
    PRIMARY KEY (price_id, prices_category_id),
    CONSTRAINT fk_prices FOREIGN KEY (price_id) REFERENCES prices (id) ON DELETE CASCADE,
    CONSTRAINT fk_prices_categories FOREIGN KEY (prices_category_id) REFERENCES prices_categories (id) ON DELETE CASCADE
);

INSERT INTO products (id, name, ean) VALUES
    ('550e8400-e29b-41d4-a716-446655440000', 'Smartphone X', '1234567890123'),
    ('660f9511-fd7a-4a2b-89e4-5b3cddfcb49a', 'Laptop Pro 15', '9876543210987');

INSERT INTO prices (id, product_id, price, currency) VALUES
    (1, '550e8400-e29b-41d4-a716-446655440000', 282.64, 'EUR'),
    (2, '660f9511-fd7a-4a2b-89e4-5b3cddfcb49a', 1451.32, 'USD');

INSERT INTO prices_categories (id, name) VALUES
    (1, 'Whole sale price'),
    (2, 'Retail price'),
    (3, 'Summer price'),
    (4, 'Winter price');

INSERT INTO prices_and_prices_categories (price_id, prices_category_id) VALUES
    (1, 2),
    (1, 3),
    (2, 1),
    (2, 3);

ALTER TABLE prices ALTER COLUMN id RESTART WITH 3;
ALTER TABLE prices_categories ALTER COLUMN id RESTART WITH 5;